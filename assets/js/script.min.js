"use strict";

$(document).on('click', 'a.js-link', scrollToLink);
$(document).on('click', 'a.js-link-top', scrollToLink);

function scrollToLink() {
  $("html, body").animate({
    scrollTop: $($(this).attr("href")).offset().top - 40 + "px"
  }, {
    duration: 400,
    easing: "swing"
  });
  return false;
} // js-form-service


$('*[data-service]').click(function (e) {
  $('#js-form-service')[0].value = $(e.currentTarget).attr('data-service');
}); // header btn click function

$(document).ready(function () {
  $("a.js-link").click(function (e) {
    e.preventDefault();
    $('.navbar-collapse.show').collapse('hide');
    $('.js-navbar-toggle span').toggleClass('d-none');
    $('.js-navbar-toggle svg').toggleClass('d-none');
  });
});
$('.js-navbar-toggle').click(headerBtnTimes);

function headerBtnTimes() {
  $('.js-navbar-toggle span').toggleClass('d-none');
  $('.js-navbar-toggle svg').toggleClass('d-none');
}

$('#myModal').on('shown.bs.modal', function () {
  $('#myInput').trigger('focus');
});
new Selectr('#yourcity', {
  searchable: false
}); // Эти плагины инициализируются в vue  приложении
// new Selectr('.priceSelect', { 
//     searchable: false
// }); 
// var swiper = new Swiper('.swiper-container', {
//     loop: false,
//     slidesPerView: 6,   
//     spaceBetween: 30,
//     grubCursor: true, 
//     scrollbar: {
//         el: '.swiper-scrollbar',
//         hide: false,
//         dragSize: 135
//     },
//     breakpoints: {
//         // when window width is >= 320px
//         320: {
//         slidesPerView: 2,
//         spaceBetween: 10,
//         scrollbar: { 
//             dragSize: 25
//         },
//         },
//         // when window width is >= 480px
//         576: {
//         slidesPerView: 3,
//         spaceBetween: 10
//         },
//         // when window width is >= 640px
//         998: {
//             slidesPerView: 6,   
//             spaceBetween: 30,
//         }
//     }
// });
// header sticty function

$(window).scroll(setScrollHeader);
$(window).on('load', setScrollHeader);

function setScrollHeader() {
  if ($(this).scrollTop() > 1) {
    $('header').addClass("sticky");
  } else {
    $('header').removeClass("sticky");
  }
}

var app = new Vue({
  el: '#app',
  computed: {
    productPrice: function productPrice() {
      return 0.1;
    }
  },
  data: function data() {
    return {
      products: [{
        id: 1,
        name: 'MacBook Pro 2010',
        factor: 0,
        url: 'mac2010.png'
      }, {
        id: 2,
        name: 'MacBook Pro  2012',
        factor: 0.1,
        url: 'mac2012.png'
      }, {
        id: 3,
        name: 'MacBook Pro  2015',
        factor: 0.2,
        url: 'mac2015.png'
      }, {
        id: 4,
        name: 'MacBook Pro 2017',
        factor: 0.3,
        url: 'mac2017.png'
      }, {
        id: 5,
        name: 'MacBook Pro  2019',
        factor: 0.4,
        url: 'mac2019.png'
      }, {
        id: 6,
        name: 'MacBook Pro  2020',
        factor: 0.5,
        url: 'mac2020.png'
      }, {
        id: 7,
        name: 'MacBook Air 2009',
        factor: 0,
        url: 'macAir2009.png'
      }, {
        id: 8,
        name: 'MacBook Air 2012',
        factor: 0.1,
        url: 'macAir2012.png'
      }, {
        id: 9,
        name: 'MacBook Air 2015',
        factor: 0.2,
        url: 'macAir2015.png'
      }, {
        id: 10,
        name: 'MacBook Air 2017',
        factor: 0.3,
        url: 'macAir2017.png'
      }, {
        id: 11,
        name: 'MacBook Air 2020',
        factor: 0.5,
        url: 'macAir2020.png'
      }],
      services: [{
        id: 1,
        name: 'Переустановка macOS',
        startedPrice: 595,
        activePrice: 595,
        time: 'от 1 часа',
        classActive: false
      }, {
        id: 2,
        name: 'Замена и ремонт дискретных элементов',
        startedPrice: 495,
        activePrice: 495,
        time: 'от 1,5 часа',
        classActive: false
      }, {
        id: 3,
        name: 'Замена и ремонт клавиатуры',
        startedPrice: 495,
        activePrice: 495,
        time: 'от 30 минут',
        classActive: false
      }, {
        id: 4,
        name: 'Замена и ремонт интегрированных элементов ',
        startedPrice: 595,
        activePrice: 595,
        time: 'от 1 часа',
        classActive: false
      }, {
        id: 5,
        name: 'Замена оперативной памяти',
        startedPrice: 495,
        activePrice: 495,
        time: 'от 30 минут',
        classActive: false
      }, {
        id: 6,
        name: 'Замена порта USB',
        startedPrice: 495,
        activePrice: 495,
        time: 'от 1,5 часа',
        classActive: false
      }, {
        id: 7,
        name: 'Замена разъема питания',
        startedPrice: 495,
        activePrice: 495,
        time: 'от 1,5 часа',
        classActive: false
      }, {
        id: 8,
        name: 'Замена термопасты',
        startedPrice: 445,
        activePrice: 445,
        time: 'от 40 минут',
        classActive: false
      }, {
        id: 9,
        name: 'Замена wi-fi модуля',
        startedPrice: 495,
        activePrice: 495,
        time: 'от 1,5 часа',
        classActive: false
      }, {
        id: 10,
        name: 'Починка и замена матрицы',
        startedPrice: 595,
        activePrice: 595,
        time: 'от 1 часа',
        classActive: false
      }, {
        id: 11,
        name: 'Починка и замена разъемов',
        startedPrice: 495,
        activePrice: 495,
        time: 'от 1 часа',
        classActive: false
      }, {
        id: 12,
        name: 'Починка и замена шлейфа матрицы',
        startedPrice: 595,
        activePrice: 595,
        time: 'от 1,5 часа',
        classActive: false
      }, {
        id: 13,
        name: 'Починка и чистка системы охлаждения',
        startedPrice: 595,
        activePrice: 595,
        time: 'от 1 часа',
        classActive: false
      }, {
        id: 14,
        name: 'Починка и замена видеокарты ',
        startedPrice: 595,
        activePrice: 595,
        time: 'от 40 минут',
        classActive: false
      }, {
        id: 15,
        name: 'Починка лампы подсветки матрицы',
        startedPrice: 595,
        activePrice: 595,
        time: 'от 1 часа',
        classActive: false
      }],
      isActiveProduct: 1,
      formServices: '',
      showAllLiButton: false,
      formPriceSum: 0,
      changedServices: [],
      changedProduct: {
        id: 1,
        name: 'MacBook Pro 2010',
        factor: 0,
        url: 'mac2010.png'
      }
    };
  },
  methods: {
    setActiveProduct: function setActiveProduct(product) {
      this.changedProduct = product;
      this.isActiveProduct = this.changedProduct.id;

      for (var i = 0; i < this.changedServices.length; i++) {
        this.changedServices[i].classActive = false;
      }

      this.changedServices = [];
      this.formPriceSum = 0;
      this.setActualPrices(this.changedProduct.factor);
      this.setFormServices();
    },
    setActiveServices: function setActiveServices(id) {
      if (this.changedServices.length < 4) {
        this.showAllLiButton = false;
      }

      for (var i = 0; i < this.changedServices.length; i++) {
        if (this.changedServices[i].id === id) {
          this.changedServices[i].classActive = false;
          this.changedServices.splice(i, 1);
          this.setFormServices();
          this.setFormPriceSum();
          return false;
        }
      }

      this.changedServices.push(this.services[id - 1]);
      this.services[id - 1].classActive = true;
      this.setFormServices();
      this.setFormPriceSum();
    },
    setActualPrices: function setActualPrices(factor) {
      for (var i = 0; i < this.services.length; i++) {
        var newPrice = Math.round((factor * this.services[i].startedPrice + this.services[i].startedPrice) / 10) * 10 - 5; // окрушление до сотен вверх 
        // let newPrice =  (Math.ceil( ( (factor * this.services[i].startedPrice ) + this.services[i].startedPrice  ) / 100  ) * 100) - 5

        this.services[i].activePrice = newPrice;
      }
    },
    setFormServices: function setFormServices() {
      var servicesString = '';

      for (var i = 0; i < this.changedServices.length; i++) {
        servicesString += this.changedServices[i].name + ', ';
      }

      this.formServices = servicesString;
    },
    setFormPriceSum: function setFormPriceSum() {
      var priceSum = 0;

      for (var i = 0; i < this.changedServices.length; i++) {
        priceSum += this.changedServices[i].activePrice;
      }

      this.formPriceSum = priceSum;
    },
    showAllLi: function showAllLi() {
      this.showAllLiButton = true;
    }
  },
  mounted: function mounted() {
    var swiper = new Swiper('.swiper-container', {
      loop: false,
      slidesPerView: 2,
      spaceBetween: 10,
      grubCursor: true,
      scrollbar: {
        el: '.swiper-scrollbar',
        hide: false,
        dragSize: 135
      },
      breakpoints: {
        // when window width is >= 320px
        320: {
          slidesPerView: 2,
          spaceBetween: 10,
          scrollbar: {
            dragSize: 50
          }
        },
        // when window width is >= 480px
        576: {
          slidesPerView: 3,
          spaceBetween: 10
        },
        // when window width is >= 640px
        998: {
          slidesPerView: 6,
          spaceBetween: 30
        }
      }
    });
  },
  template: "<div class=\"mac-price heading\">\n    <div class=\"container \">\n        <h3>\n            \u0426\u0435\u043D\u044B\n            <span>\n                \u043D\u0430 \u0440\u0435\u043C\u043E\u043D\u0442\n            </span>\n            MacBook\n        </h3>\n        <div class=\"mac-price-scroll\">\n            <div class=\"swiper-container\">\n                <div class=\"swiper-scrollbar\"></div>\n                \n                <div class=\"swiper-wrapper\">  \n                        <div class=\"swiper-slide\" v-for=\"product in products\" :key=\"product.id\" >\n                            <div class=\"mac-price-scroll_item\" \n                                :class=\"(isActiveProduct === product.id) ? 'active' : 'a' \"   \n                                @click='setActiveProduct(product)'\n                            >\n                                <div class=\"mac-price-scroll_item__image\" v-bind:style=\"{ 'background-image': 'url(assets/img/macbooks/' + product.url + ')' }\"></div>\n                                <div class=\"mac-price-scroll_item__text\">\n                                    {{ product.name }} \n                                </div>\n                            </div>\n                        </div>  \n                         \n                </div> \n                \n            </div>\n        </div>\n  \n        <div class=\"d-flex flex-column flex-lg-row \">\n            <div class=\"mac-price_block\">\n                <!-- Free services -->\n                <div class=\"mac-price_block_item disabled\">\n                    <div class=\"title\">\n                        \u0412\u044B\u0435\u0437\u0434 \u043C\u0430\u0441\u0442\u0435\u0440\u0430\n                    </div>\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <span class=\"price\">\n                            \u0411\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E\n                        </span>\n                        <span class=\"time\">\n                            \u043E\u0442 1 \u0447\u0430\u0441\u0430\n                        </span>\n                    </div>\n                </div>\n                <div class=\"mac-price_block_item disabled\">\n                    <div class=\"title \">\n                        \u0414\u043E\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0432 <br>\n                        \u0441\u0435\u0440\u0432\u0438\u0441-\u0446\u0435\u043D\u0442\u0440 \u0438 \u043E\u0431\u0440\u0430\u0442\u043D\u043E\n                    </div>\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <span class=\"price\">\n                            \u0411\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E\n                        </span>\n                        <span class=\"time\">\n                            \u043E\u0442 1 \u0447\u0430\u0441\u0430\n                        </span>\n                    </div>\n                </div>\n                <div class=\"mac-price_block_item disabled\">\n                    <div class=\"title\">\n                        \u0414\u0438\u0430\u0433\u043D\u043E\u0441\u0442\u0438\u043A\u0430  <br>\n                        {{ this.changedProduct.name}}\n                    </div>\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <span class=\"price\">\n                            \u0411\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E\n                        </span>\n                        <span class=\"time\">\n                            \u043E\u0442 1 \u0447\u0430\u0441\u0430\n                        </span>\n                    </div>\n                </div>\n  \n                <!-- loop service -->\n                <div class=\"mac-price_block_item\" \n                    v-for='(service, index) in services' \n                    :key=\"index\"\n                    @click=\"setActiveServices(service.id)\"\n                    :class=\"service.classActive ? 'active' : '' \"\n                >\n                    <div class=\"title\">\n                        {{ service.name }}\n                    </div>\n                    <div class=\"d-flex justify-content-between align-items-center\">\n                        <span class=\"price\">  \n                            \u043E\u0442 {{ service.activePrice  }} \u0420\u0443\u0431. \n                        </span>\n                        <span class=\"time\">\n                        {{ service.time }} \n                        </span>\n                    </div>\n                </div>\n                \n            </div>\n            <div class=\"mac-price_form\">\n                <h5>\n                    \u0412\u044B\u0437\u043E\u0432\u0438\u0442\u0435 \u043C\u0430\u0441\u0442\u0435\u0440\u0430 \u0431\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E\n                </h5>\n               \n                <div class=\"mac-price_form-list_services\" v-if=\"this.changedServices.length > 0\">\n                    <p>\n                        \u0421\u043F\u0438\u0441\u043E\u043A \u043F\u043E\u043B\u043E\u043C\u043E\u043A:\n                    </p>\n                    <ul :class=\"showAllLiButton ? 'show_all' : '' \"> \n                        <li v-for=\"(service , index) in changedServices\" :key='index' @click=' setActiveServices(service.id)'>\n                            <i > \n                                <svg>\n                                    <use xlink:href=\"#close\"></use>\n                                </svg>\n                            </i>\n                            {{ service.name }} - \u043E\u0442 {{ service.activePrice }} \u0420\u0443\u0431.\n                        </li>\n                        <li>\n                             \u0412\u044B\u0435\u0437\u0434 \u043C\u0430\u0441\u0442\u0435\u0440\u0430 \u0438 \u0434\u0438\u0430\u0433\u043D\u043E\u0441\u0442\u0438\u043A\u0430 - \u0411\u0435\u0441\u043F\u043B\u0430\u0442\u043D\u043E\n                        </li>\n                        \n                    </ul>\n                    <div  class=\"mac-price_form-list_services_btn\">\n                        <button v-if=\"this.changedServices.length > 4 && !this.showAllLiButton\" @click=\"showAllLi\">\n                            \u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u0432\u0441\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u043F\u043E\u043B\u043E\u043C\u043A\u0438 ({{this.changedServices.length}})\n                        </button>\n                    </div>\n                  \n                </div>\n                \n               \n            <div v-if='this.formPriceSum > 0'>\n                    <h6>\n                        \u0426\u0435\u043D\u0430 \u0440\u0435\u043C\u043E\u043D\u0442\u0430\n                    </h6>\n                    <div class=\"mac-price_form-price \">\n                        \u043E\u0442 &nbsp;\n                        <div class=\"price\">  \n                            {{ this.formPriceSum }}\n                        </div>\n                        &nbsp; \u0420\u0443\u0431\u043B\u0435\u0439\n                    </div>\n            </div>\n            <div v-else>\n                    <h6 class=\"mb-5\">\n                        \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u043E\u043B\u043E\u043C\u043A\u0443 \u0447\u0442\u043E\u0431\u044B \u043F\u043E\u0441\u0447\u0438\u0442\u0430\u0442\u044C \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C \u0440\u0435\u043C\u043E\u043D\u0442\u0430\n                    </h6>\n            </div>\n                <form>\n                    <div class=\"mac-price_form_group\">\n                        <span>\n                            <input type=\"hidden\" name=\"services\" v-model=\"formServices\" >\n                        </span>\n                        <span>\n                            <input type=\"hidden\" name=\"product\" v-model=\"changedProduct.name\" >\n                        </span>\n                        <span>\n                            <input type=\"hidden\" name=\"price\" v-model=\"formPriceSum\" >\n                        </span>\n                        <span>\n                            <input type=\"text\" name=\"name\" required placeholder=\"\u0412\u0430\u0448\u0435 \u0438\u043C\u044F\">\n                        </span>\n                        <span>\n                            <input type=\"tel\" name=\"phone\" required placeholder=\"\u0412\u0430\u0448 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\">\n                        </span> \n                        <div class=\"btn-form\">\n                            <button type=\"submit\">\n                                \u0412\u044B\u0437\u0432\u0430\u0442\u044C \u043C\u0430\u0441\u0442\u0435\u0440\u0430\n                            </button>\n                        </div> \n                    </div>\n                </form>\n                <span>\n                    \u041D\u0430\u0436\u0438\u043C\u0430\u044F \u043A\u043D\u043E\u043F\u043A\u0443 \"\u0412\u044B\u0437\u0432\u0430\u0442\u044C \u043C\u0430\u0441\u0442\u0435\u0440\u0430\" \u0412\u044B \u0441\u043E\u0433\u043B\u0430\u0448\u0430\u0435\u0442\u0435\u0441\u044C \u043D\u0430 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0443 \u0412\u0430\u0448\u0438\u0445 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0445 \u0434\u0430\u043D\u043D\u044B\u0445\n                </span>\n            </div>\n        </div>\n        \n    </div>\n  </div> "
});